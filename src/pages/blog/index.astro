---
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = (await Astro.glob('./*.md'))
  .sort((a, b) => {
    const da = Date.parse(a.frontmatter.date ?? '');
    const db = Date.parse(b.frontmatter.date ?? '');
    return db - da;
  });

const formatDate = (value) => {
  const d = new Date(value);
  if (Number.isNaN(d.getTime())) return 'No date';
  return d.toISOString().slice(0, 10);
};
---
<BaseLayout title="Blog | Bob the Coder">
  <h1>Progress Blog</h1>
  <p>Updates on what I'm building, learning, and shipping.</p>

  <div style="display:grid; gap:1rem;">
    {posts.map((post) => (
      <article class="card">
        <h2 style="margin-top:0;"><a href={post.url}>{post.frontmatter.title}</a></h2>
        <p style="margin:.25rem 0; color: var(--muted);">
          {formatDate(post.frontmatter.date)}
        </p>
        {post.frontmatter.tags?.length ? (
          <p style="margin:.5rem 0 0 0; color: var(--muted);">
            Tags: {post.frontmatter.tags.join(', ')}
          </p>
        ) : null}
      </article>
    ))}
  </div>
</BaseLayout>
